{"version":3,"sources":["../../../../node_modules/babel-helper-remap-async-to-generator/lib/index.js"],"names":["exports","__esModule","default","path","file","helpers","wrapAsync","traverse","awaitVisitor","wrapAwait","isClassMethod","isObjectMethod","classOrObjectMethod","plainFunction","_babelHelperFunctionName","require","_babelHelperFunctionName2","_interopRequireDefault","_babelTemplate","_babelTemplate2","_babelTypes","t","_interopRequireWildcard","_forAwait","_forAwait2","obj","newObj","key","Object","prototype","hasOwnProperty","call","buildWrapper","namedBuildWrapper","Function","isArrowFunctionExpression","node","async","arrowFunctionToShadowed","skip","AwaitExpression","_ref","_ref2","type","argument","callExpression","ForAwaitStatement","_ref3","build","getAsyncIterator","addHelper","declar","loop","block","body","ensureBlock","push","concat","inherits","replaceParent","parentPath","replaceWithMultiple","remove","callId","container","functionExpression","blockStatement","shadow","returnStatement","generator","isDeclaration","isFunctionDeclaration","asyncFnId","id","wrapper","built","NAME","REF","scope","generateUidIdentifier","FUNCTION","PARAMS","params","reduce","acc","param","done","isAssignmentPattern","isRestElement","expression","variableDeclaration","variableDeclarator","identifier","name","_blockHoist","replaceWith","retFunction","parent","length","module"],"mappings":"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","file":"index.js","sourcesContent":["\"use strict\";\n\nexports.__esModule = true;\n\nexports.default = function (path, file, helpers) {\n  if (!helpers) {\n    helpers = { wrapAsync: file };\n    file = null;\n  }\n  path.traverse(awaitVisitor, {\n    file: file,\n    wrapAwait: helpers.wrapAwait\n  });\n\n  if (path.isClassMethod() || path.isObjectMethod()) {\n    classOrObjectMethod(path, helpers.wrapAsync);\n  } else {\n    plainFunction(path, helpers.wrapAsync);\n  }\n};\n\nvar _babelHelperFunctionName = require(\"babel-helper-function-name\");\n\nvar _babelHelperFunctionName2 = _interopRequireDefault(_babelHelperFunctionName);\n\nvar _babelTemplate = require(\"babel-template\");\n\nvar _babelTemplate2 = _interopRequireDefault(_babelTemplate);\n\nvar _babelTypes = require(\"babel-types\");\n\nvar t = _interopRequireWildcard(_babelTypes);\n\nvar _forAwait = require(\"./for-await\");\n\nvar _forAwait2 = _interopRequireDefault(_forAwait);\n\nfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar buildWrapper = (0, _babelTemplate2.default)(\"\\n  (() => {\\n    var REF = FUNCTION;\\n    return function NAME(PARAMS) {\\n      return REF.apply(this, arguments);\\n    };\\n  })\\n\");\n\nvar namedBuildWrapper = (0, _babelTemplate2.default)(\"\\n  (() => {\\n    var REF = FUNCTION;\\n    function NAME(PARAMS) {\\n      return REF.apply(this, arguments);\\n    }\\n    return NAME;\\n  })\\n\");\n\nvar awaitVisitor = {\n  Function: function Function(path) {\n    if (path.isArrowFunctionExpression() && !path.node.async) {\n      path.arrowFunctionToShadowed();\n      return;\n    }\n    path.skip();\n  },\n  AwaitExpression: function AwaitExpression(_ref, _ref2) {\n    var node = _ref.node;\n    var wrapAwait = _ref2.wrapAwait;\n\n    node.type = \"YieldExpression\";\n    if (wrapAwait) {\n      node.argument = t.callExpression(wrapAwait, [node.argument]);\n    }\n  },\n  ForAwaitStatement: function ForAwaitStatement(path, _ref3) {\n    var file = _ref3.file,\n        wrapAwait = _ref3.wrapAwait;\n    var node = path.node;\n\n\n    var build = (0, _forAwait2.default)(path, {\n      getAsyncIterator: file.addHelper(\"asyncIterator\"),\n      wrapAwait: wrapAwait\n    });\n\n    var declar = build.declar,\n        loop = build.loop;\n\n    var block = loop.body;\n\n    path.ensureBlock();\n\n    if (declar) {\n      block.body.push(declar);\n    }\n\n    block.body = block.body.concat(node.body.body);\n\n    t.inherits(loop, node);\n    t.inherits(loop.body, node.body);\n\n    if (build.replaceParent) {\n      path.parentPath.replaceWithMultiple(build.node);\n      path.remove();\n    } else {\n      path.replaceWithMultiple(build.node);\n    }\n  }\n};\n\nfunction classOrObjectMethod(path, callId) {\n  var node = path.node;\n  var body = node.body;\n\n  node.async = false;\n\n  var container = t.functionExpression(null, [], t.blockStatement(body.body), true);\n  container.shadow = true;\n  body.body = [t.returnStatement(t.callExpression(t.callExpression(callId, [container]), []))];\n\n  node.generator = false;\n}\n\nfunction plainFunction(path, callId) {\n  var node = path.node;\n  var isDeclaration = path.isFunctionDeclaration();\n  var asyncFnId = node.id;\n  var wrapper = buildWrapper;\n\n  if (path.isArrowFunctionExpression()) {\n    path.arrowFunctionToShadowed();\n  } else if (!isDeclaration && asyncFnId) {\n    wrapper = namedBuildWrapper;\n  }\n\n  node.async = false;\n  node.generator = true;\n\n  node.id = null;\n\n  if (isDeclaration) {\n    node.type = \"FunctionExpression\";\n  }\n\n  var built = t.callExpression(callId, [node]);\n  var container = wrapper({\n    NAME: asyncFnId,\n    REF: path.scope.generateUidIdentifier(\"ref\"),\n    FUNCTION: built,\n    PARAMS: node.params.reduce(function (acc, param) {\n      acc.done = acc.done || t.isAssignmentPattern(param) || t.isRestElement(param);\n\n      if (!acc.done) {\n        acc.params.push(path.scope.generateUidIdentifier(\"x\"));\n      }\n\n      return acc;\n    }, {\n      params: [],\n      done: false\n    }).params\n  }).expression;\n\n  if (isDeclaration) {\n    var declar = t.variableDeclaration(\"let\", [t.variableDeclarator(t.identifier(asyncFnId.name), t.callExpression(container, []))]);\n    declar._blockHoist = true;\n\n    path.replaceWith(declar);\n  } else {\n    var retFunction = container.body.body[1].argument;\n    if (!asyncFnId) {\n      (0, _babelHelperFunctionName2.default)({\n        node: retFunction,\n        parent: path.parent,\n        scope: path.scope\n      });\n    }\n\n    if (!retFunction || retFunction.id || node.params.length) {\n      path.replaceWith(t.callExpression(container, []));\n    } else {\n      path.replaceWith(built);\n    }\n  }\n}\n\nmodule.exports = exports[\"default\"];"]}