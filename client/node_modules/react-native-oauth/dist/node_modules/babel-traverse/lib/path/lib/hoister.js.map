{"version":3,"sources":["../../../../../../node_modules/babel-traverse/lib/path/lib/hoister.js"],"names":["exports","__esModule","_getIterator2","require","_getIterator3","_interopRequireDefault","_classCallCheck2","_classCallCheck3","_babelTypes","t","_interopRequireWildcard","obj","newObj","key","Object","prototype","hasOwnProperty","call","default","referenceVisitor","ReferencedIdentifier","path","state","isJSXIdentifier","react","isCompatTag","node","name","parentPath","isJSXMemberExpression","scope","isFunction","isArrowFunctionExpression","parent","breakOnScopePaths","push","binding","getBinding","bindings","PathHoister","scopes","attachAfter","isCompatibleScope","bindingIdentifierEquals","identifier","getCompatibleScopes","indexOf","getAttachmentPath","_getAttachmentPath","targetScope","isProgram","hasOwnBinding","kind","getAttachmentParentForPath","_iterator","constantViolations","_isArray","Array","isArray","_i","_ref","length","next","done","value","violationPath","isExportDeclaration","pop","hasOwnParamBindings","get","getNextScopeAttachmentParent","container","isStatement","isVariableDeclarator","declarations","constant","run","_hoisted","traverse","attachTo","getFunctionParent","uid","generateUidIdentifier","declarator","variableDeclarator","insertFn","variableDeclaration","isJSXElement","children","JSXExpressionContainer","replaceWith","module"],"mappings":"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","file":"hoister.js","sourcesContent":["\"use strict\";\n\nexports.__esModule = true;\n\nvar _getIterator2 = require(\"babel-runtime/core-js/get-iterator\");\n\nvar _getIterator3 = _interopRequireDefault(_getIterator2);\n\nvar _classCallCheck2 = require(\"babel-runtime/helpers/classCallCheck\");\n\nvar _classCallCheck3 = _interopRequireDefault(_classCallCheck2);\n\nvar _babelTypes = require(\"babel-types\");\n\nvar t = _interopRequireWildcard(_babelTypes);\n\nfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar referenceVisitor = {\n  ReferencedIdentifier: function ReferencedIdentifier(path, state) {\n    if (path.isJSXIdentifier() && _babelTypes.react.isCompatTag(path.node.name) && !path.parentPath.isJSXMemberExpression()) {\n      return;\n    }\n\n    if (path.node.name === \"this\") {\n      var scope = path.scope;\n      do {\n        if (scope.path.isFunction() && !scope.path.isArrowFunctionExpression()) break;\n      } while (scope = scope.parent);\n      if (scope) state.breakOnScopePaths.push(scope.path);\n    }\n\n    var binding = path.scope.getBinding(path.node.name);\n    if (!binding) return;\n\n    if (binding !== state.scope.getBinding(path.node.name)) return;\n\n    state.bindings[path.node.name] = binding;\n  }\n};\n\nvar PathHoister = function () {\n  function PathHoister(path, scope) {\n    (0, _classCallCheck3.default)(this, PathHoister);\n\n    this.breakOnScopePaths = [];\n\n    this.bindings = {};\n\n    this.scopes = [];\n\n    this.scope = scope;\n    this.path = path;\n\n    this.attachAfter = false;\n  }\n\n  PathHoister.prototype.isCompatibleScope = function isCompatibleScope(scope) {\n    for (var key in this.bindings) {\n      var binding = this.bindings[key];\n      if (!scope.bindingIdentifierEquals(key, binding.identifier)) {\n        return false;\n      }\n    }\n\n    return true;\n  };\n\n  PathHoister.prototype.getCompatibleScopes = function getCompatibleScopes() {\n    var scope = this.path.scope;\n    do {\n      if (this.isCompatibleScope(scope)) {\n        this.scopes.push(scope);\n      } else {\n        break;\n      }\n\n      if (this.breakOnScopePaths.indexOf(scope.path) >= 0) {\n        break;\n      }\n    } while (scope = scope.parent);\n  };\n\n  PathHoister.prototype.getAttachmentPath = function getAttachmentPath() {\n    var path = this._getAttachmentPath();\n    if (!path) return;\n\n    var targetScope = path.scope;\n\n    if (targetScope.path === path) {\n      targetScope = path.scope.parent;\n    }\n\n    if (targetScope.path.isProgram() || targetScope.path.isFunction()) {\n      for (var name in this.bindings) {\n        if (!targetScope.hasOwnBinding(name)) continue;\n\n        var binding = this.bindings[name];\n\n        if (binding.kind === \"param\") continue;\n\n        if (this.getAttachmentParentForPath(binding.path).key > path.key) {\n          this.attachAfter = true;\n          path = binding.path;\n\n          for (var _iterator = binding.constantViolations, _isArray = Array.isArray(_iterator), _i = 0, _iterator = _isArray ? _iterator : (0, _getIterator3.default)(_iterator);;) {\n            var _ref;\n\n            if (_isArray) {\n              if (_i >= _iterator.length) break;\n              _ref = _iterator[_i++];\n            } else {\n              _i = _iterator.next();\n              if (_i.done) break;\n              _ref = _i.value;\n            }\n\n            var violationPath = _ref;\n\n            if (this.getAttachmentParentForPath(violationPath).key > path.key) {\n              path = violationPath;\n            }\n          }\n        }\n      }\n    }\n\n    if (path.parentPath.isExportDeclaration()) {\n      path = path.parentPath;\n    }\n\n    return path;\n  };\n\n  PathHoister.prototype._getAttachmentPath = function _getAttachmentPath() {\n    var scopes = this.scopes;\n\n    var scope = scopes.pop();\n\n    if (!scope) return;\n\n    if (scope.path.isFunction()) {\n      if (this.hasOwnParamBindings(scope)) {\n        if (this.scope === scope) return;\n\n        return scope.path.get(\"body\").get(\"body\")[0];\n      } else {\n        return this.getNextScopeAttachmentParent();\n      }\n    } else if (scope.path.isProgram()) {\n      return this.getNextScopeAttachmentParent();\n    }\n  };\n\n  PathHoister.prototype.getNextScopeAttachmentParent = function getNextScopeAttachmentParent() {\n    var scope = this.scopes.pop();\n    if (scope) return this.getAttachmentParentForPath(scope.path);\n  };\n\n  PathHoister.prototype.getAttachmentParentForPath = function getAttachmentParentForPath(path) {\n    do {\n      if (!path.parentPath || Array.isArray(path.container) && path.isStatement() || path.isVariableDeclarator() && path.parentPath.node !== null && path.parentPath.node.declarations.length > 1) return path;\n    } while (path = path.parentPath);\n  };\n\n  PathHoister.prototype.hasOwnParamBindings = function hasOwnParamBindings(scope) {\n    for (var name in this.bindings) {\n      if (!scope.hasOwnBinding(name)) continue;\n\n      var binding = this.bindings[name];\n\n      if (binding.kind === \"param\" && binding.constant) return true;\n    }\n    return false;\n  };\n\n  PathHoister.prototype.run = function run() {\n    var node = this.path.node;\n    if (node._hoisted) return;\n    node._hoisted = true;\n\n    this.path.traverse(referenceVisitor, this);\n\n    this.getCompatibleScopes();\n\n    var attachTo = this.getAttachmentPath();\n    if (!attachTo) return;\n\n    if (attachTo.getFunctionParent() === this.path.getFunctionParent()) return;\n\n    var uid = attachTo.scope.generateUidIdentifier(\"ref\");\n    var declarator = t.variableDeclarator(uid, this.path.node);\n\n    var insertFn = this.attachAfter ? \"insertAfter\" : \"insertBefore\";\n    attachTo[insertFn]([attachTo.isVariableDeclarator() ? declarator : t.variableDeclaration(\"var\", [declarator])]);\n\n    var parent = this.path.parentPath;\n    if (parent.isJSXElement() && this.path.container === parent.node.children) {\n      uid = t.JSXExpressionContainer(uid);\n    }\n\n    this.path.replaceWith(uid);\n  };\n\n  return PathHoister;\n}();\n\nexports.default = PathHoister;\nmodule.exports = exports[\"default\"];"]}