{"version":3,"sources":["../../../../node_modules/babel-plugin-transform-es2015-block-scoping/lib/tdz.js"],"names":["exports","__esModule","visitor","undefined","_babelTypes","require","t","_interopRequireWildcard","obj","newObj","key","Object","prototype","hasOwnProperty","call","default","getTDZStatus","refPath","bindingPath","executionStatus","_guessExecutionStatusRelativeTo","buildTDZAssert","node","file","callExpression","addHelper","stringLiteral","name","isReference","scope","state","declared","letReferences","getBindingIdentifier","ReferencedIdentifier","path","opts","tdz","parent","parentPath","isFor","left","getBinding","status","assert","_tdzThis","skip","isUpdateExpression","_ignoreBlockScopingTDZ","replaceWith","sequenceExpression","throwStatement","inherits","newExpression","identifier","AssignmentExpression","exit","nodes","ids","getBindingIdentifiers","id","push","length","replaceWithMultiple","map","expressionStatement"],"mappings":"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","file":"tdz.js","sourcesContent":["\"use strict\";\n\nexports.__esModule = true;\nexports.visitor = undefined;\n\nvar _babelTypes = require(\"babel-types\");\n\nvar t = _interopRequireWildcard(_babelTypes);\n\nfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }\n\nfunction getTDZStatus(refPath, bindingPath) {\n  var executionStatus = bindingPath._guessExecutionStatusRelativeTo(refPath);\n\n  if (executionStatus === \"before\") {\n    return \"inside\";\n  } else if (executionStatus === \"after\") {\n    return \"outside\";\n  } else {\n    return \"maybe\";\n  }\n}\n\nfunction buildTDZAssert(node, file) {\n  return t.callExpression(file.addHelper(\"temporalRef\"), [node, t.stringLiteral(node.name), file.addHelper(\"temporalUndefined\")]);\n}\n\nfunction isReference(node, scope, state) {\n  var declared = state.letReferences[node.name];\n  if (!declared) return false;\n\n  return scope.getBindingIdentifier(node.name) === declared;\n}\n\nvar visitor = exports.visitor = {\n  ReferencedIdentifier: function ReferencedIdentifier(path, state) {\n    if (!this.file.opts.tdz) return;\n\n    var node = path.node,\n        parent = path.parent,\n        scope = path.scope;\n\n\n    if (path.parentPath.isFor({ left: node })) return;\n    if (!isReference(node, scope, state)) return;\n\n    var bindingPath = scope.getBinding(node.name).path;\n\n    var status = getTDZStatus(path, bindingPath);\n    if (status === \"inside\") return;\n\n    if (status === \"maybe\") {\n      var assert = buildTDZAssert(node, state.file);\n\n      bindingPath.parent._tdzThis = true;\n\n      path.skip();\n\n      if (path.parentPath.isUpdateExpression()) {\n        if (parent._ignoreBlockScopingTDZ) return;\n        path.parentPath.replaceWith(t.sequenceExpression([assert, parent]));\n      } else {\n        path.replaceWith(assert);\n      }\n    } else if (status === \"outside\") {\n      path.replaceWith(t.throwStatement(t.inherits(t.newExpression(t.identifier(\"ReferenceError\"), [t.stringLiteral(node.name + \" is not defined - temporal dead zone\")]), node)));\n    }\n  },\n\n\n  AssignmentExpression: {\n    exit: function exit(path, state) {\n      if (!this.file.opts.tdz) return;\n\n      var node = path.node;\n\n      if (node._ignoreBlockScopingTDZ) return;\n\n      var nodes = [];\n      var ids = path.getBindingIdentifiers();\n\n      for (var name in ids) {\n        var id = ids[name];\n\n        if (isReference(id, path.scope, state)) {\n          nodes.push(buildTDZAssert(id, state.file));\n        }\n      }\n\n      if (nodes.length) {\n        node._ignoreBlockScopingTDZ = true;\n        nodes.push(node);\n        path.replaceWithMultiple(nodes.map(t.expressionStatement));\n      }\n    }\n  }\n};"]}