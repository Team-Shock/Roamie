{"version":3,"sources":["../../../../node_modules/babel-plugin-transform-es2015-parameters/lib/rest.js"],"names":["exports","__esModule","visitor","undefined","_getIterator2","require","_getIterator3","_interopRequireDefault","_babelTemplate","_babelTemplate2","_babelTypes","t","_interopRequireWildcard","obj","newObj","key","Object","prototype","hasOwnProperty","call","default","buildRest","restIndex","restIndexImpure","restLength","memberExpressionOptimisationVisitor","Scope","path","state","scope","bindingIdentifierEquals","name","outerBinding","skip","Flow","isTypeCastExpression","FunctionClassProperty","oldNoOptimise","noOptimise","traverse","ReferencedIdentifier","node","deopted","parentPath","listKey","offset","isMemberExpression","object","grandparentPath","argsOptEligible","isAssignmentExpression","left","isLVal","isForXStatement","isUpdateExpression","isUnaryExpression","operator","isCallExpression","isNewExpression","callee","computed","get","isBaseType","candidates","push","cause","property","isSpreadElement","arguments","length","references","BindingIdentifier","_ref","hasRest","isRestElement","params","optimiseIndexGetter","argsId","index","isNumericLiteral","parent","numericLiteral","value","binaryExpression","isPure","temp","generateUidIdentifierBasedOnNode","id","kind","replaceWith","ARGUMENTS","INDEX","REF","optimiseLengthGetter","OFFSET","Function","rest","pop","argument","identifier","_shadowedFunctionLiteral","argumentsNode","getBindingIdentifier","_iterator","_isArray","Array","isArray","_i","_ref3","next","done","_ref4","_path","concat","map","_ref5","shadow","start","generateUidIdentifier","len","arrKey","arrLen","conditionalExpression","loop","ARRAY_KEY","ARRAY_LEN","START","ARRAY","KEY","LEN","_blockHoist","body","unshift","target","getEarliestCommonAncestorFrom","getStatementParent","findParent","isLoop","isFunction","insertBefore"],"mappings":"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","file":"rest.js","sourcesContent":["\"use strict\";\n\nexports.__esModule = true;\nexports.visitor = undefined;\n\nvar _getIterator2 = require(\"babel-runtime/core-js/get-iterator\");\n\nvar _getIterator3 = _interopRequireDefault(_getIterator2);\n\nvar _babelTemplate = require(\"babel-template\");\n\nvar _babelTemplate2 = _interopRequireDefault(_babelTemplate);\n\nvar _babelTypes = require(\"babel-types\");\n\nvar t = _interopRequireWildcard(_babelTypes);\n\nfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar buildRest = (0, _babelTemplate2.default)(\"\\n  for (var LEN = ARGUMENTS.length,\\n           ARRAY = Array(ARRAY_LEN),\\n           KEY = START;\\n       KEY < LEN;\\n       KEY++) {\\n    ARRAY[ARRAY_KEY] = ARGUMENTS[KEY];\\n  }\\n\");\n\nvar restIndex = (0, _babelTemplate2.default)(\"\\n  ARGUMENTS.length <= INDEX ? undefined : ARGUMENTS[INDEX]\\n\");\n\nvar restIndexImpure = (0, _babelTemplate2.default)(\"\\n  REF = INDEX, ARGUMENTS.length <= REF ? undefined : ARGUMENTS[REF]\\n\");\n\nvar restLength = (0, _babelTemplate2.default)(\"\\n  ARGUMENTS.length <= OFFSET ? 0 : ARGUMENTS.length - OFFSET\\n\");\n\nvar memberExpressionOptimisationVisitor = {\n  Scope: function Scope(path, state) {\n    if (!path.scope.bindingIdentifierEquals(state.name, state.outerBinding)) {\n      path.skip();\n    }\n  },\n  Flow: function Flow(path) {\n    if (path.isTypeCastExpression()) return;\n\n    path.skip();\n  },\n\n\n  \"Function|ClassProperty\": function FunctionClassProperty(path, state) {\n    var oldNoOptimise = state.noOptimise;\n    state.noOptimise = true;\n    path.traverse(memberExpressionOptimisationVisitor, state);\n    state.noOptimise = oldNoOptimise;\n\n    path.skip();\n  },\n\n  ReferencedIdentifier: function ReferencedIdentifier(path, state) {\n    var node = path.node;\n\n    if (node.name === \"arguments\") {\n      state.deopted = true;\n    }\n\n    if (node.name !== state.name) return;\n\n    if (state.noOptimise) {\n      state.deopted = true;\n    } else {\n      var parentPath = path.parentPath;\n\n      if (parentPath.listKey === \"params\" && parentPath.key < state.offset) {\n        return;\n      }\n\n      if (parentPath.isMemberExpression({ object: node })) {\n        var grandparentPath = parentPath.parentPath;\n\n        var argsOptEligible = !state.deopted && !(grandparentPath.isAssignmentExpression() && parentPath.node === grandparentPath.node.left || grandparentPath.isLVal() || grandparentPath.isForXStatement() || grandparentPath.isUpdateExpression() || grandparentPath.isUnaryExpression({ operator: \"delete\" }) || (grandparentPath.isCallExpression() || grandparentPath.isNewExpression()) && parentPath.node === grandparentPath.node.callee);\n\n        if (argsOptEligible) {\n          if (parentPath.node.computed) {\n            if (parentPath.get(\"property\").isBaseType(\"number\")) {\n              state.candidates.push({ cause: \"indexGetter\", path: path });\n              return;\n            }\n          } else if (parentPath.node.property.name === \"length\") {\n              state.candidates.push({ cause: \"lengthGetter\", path: path });\n              return;\n            }\n        }\n      }\n\n      if (state.offset === 0 && parentPath.isSpreadElement()) {\n        var call = parentPath.parentPath;\n        if (call.isCallExpression() && call.node.arguments.length === 1) {\n          state.candidates.push({ cause: \"argSpread\", path: path });\n          return;\n        }\n      }\n\n      state.references.push(path);\n    }\n  },\n  BindingIdentifier: function BindingIdentifier(_ref, state) {\n    var node = _ref.node;\n\n    if (node.name === state.name) {\n      state.deopted = true;\n    }\n  }\n};\nfunction hasRest(node) {\n  return t.isRestElement(node.params[node.params.length - 1]);\n}\n\nfunction optimiseIndexGetter(path, argsId, offset) {\n  var index = void 0;\n\n  if (t.isNumericLiteral(path.parent.property)) {\n    index = t.numericLiteral(path.parent.property.value + offset);\n  } else if (offset === 0) {\n    index = path.parent.property;\n  } else {\n    index = t.binaryExpression(\"+\", path.parent.property, t.numericLiteral(offset));\n  }\n\n  var scope = path.scope;\n\n  if (!scope.isPure(index)) {\n    var temp = scope.generateUidIdentifierBasedOnNode(index);\n    scope.push({ id: temp, kind: \"var\" });\n    path.parentPath.replaceWith(restIndexImpure({\n      ARGUMENTS: argsId,\n      INDEX: index,\n      REF: temp\n    }));\n  } else {\n    path.parentPath.replaceWith(restIndex({\n      ARGUMENTS: argsId,\n      INDEX: index\n    }));\n  }\n}\n\nfunction optimiseLengthGetter(path, argsId, offset) {\n  if (offset) {\n    path.parentPath.replaceWith(restLength({\n      ARGUMENTS: argsId,\n      OFFSET: t.numericLiteral(offset)\n    }));\n  } else {\n    path.replaceWith(argsId);\n  }\n}\n\nvar visitor = exports.visitor = {\n  Function: function Function(path) {\n    var node = path.node,\n        scope = path.scope;\n\n    if (!hasRest(node)) return;\n\n    var rest = node.params.pop().argument;\n\n    var argsId = t.identifier(\"arguments\");\n\n    argsId._shadowedFunctionLiteral = path;\n\n    var state = {\n      references: [],\n      offset: node.params.length,\n\n      argumentsNode: argsId,\n      outerBinding: scope.getBindingIdentifier(rest.name),\n\n      candidates: [],\n\n      name: rest.name,\n\n      deopted: false\n    };\n\n    path.traverse(memberExpressionOptimisationVisitor, state);\n\n    if (!state.deopted && !state.references.length) {\n      for (var _iterator = state.candidates, _isArray = Array.isArray(_iterator), _i = 0, _iterator = _isArray ? _iterator : (0, _getIterator3.default)(_iterator);;) {\n        var _ref3;\n\n        if (_isArray) {\n          if (_i >= _iterator.length) break;\n          _ref3 = _iterator[_i++];\n        } else {\n          _i = _iterator.next();\n          if (_i.done) break;\n          _ref3 = _i.value;\n        }\n\n        var _ref4 = _ref3;\n        var _path = _ref4.path,\n            cause = _ref4.cause;\n\n        switch (cause) {\n          case \"indexGetter\":\n            optimiseIndexGetter(_path, argsId, state.offset);\n            break;\n          case \"lengthGetter\":\n            optimiseLengthGetter(_path, argsId, state.offset);\n            break;\n          default:\n            _path.replaceWith(argsId);\n        }\n      }\n      return;\n    }\n\n    state.references = state.references.concat(state.candidates.map(function (_ref5) {\n      var path = _ref5.path;\n      return path;\n    }));\n\n    state.deopted = state.deopted || !!node.shadow;\n\n    var start = t.numericLiteral(node.params.length);\n    var key = scope.generateUidIdentifier(\"key\");\n    var len = scope.generateUidIdentifier(\"len\");\n\n    var arrKey = key;\n    var arrLen = len;\n    if (node.params.length) {\n      arrKey = t.binaryExpression(\"-\", key, start);\n\n      arrLen = t.conditionalExpression(t.binaryExpression(\">\", len, start), t.binaryExpression(\"-\", len, start), t.numericLiteral(0));\n    }\n\n    var loop = buildRest({\n      ARGUMENTS: argsId,\n      ARRAY_KEY: arrKey,\n      ARRAY_LEN: arrLen,\n      START: start,\n      ARRAY: rest,\n      KEY: key,\n      LEN: len\n    });\n\n    if (state.deopted) {\n      loop._blockHoist = node.params.length + 1;\n      node.body.body.unshift(loop);\n    } else {\n      loop._blockHoist = 1;\n\n      var target = path.getEarliestCommonAncestorFrom(state.references).getStatementParent();\n\n      target.findParent(function (path) {\n        if (path.isLoop()) {\n          target = path;\n        } else {\n          return path.isFunction();\n        }\n      });\n\n      target.insertBefore(loop);\n    }\n  }\n};"]}